<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Moore Lab (SNRE, UA)">

<title>FLUXNET Demo Plots</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-79108a0fc1995748cbd19a5b0e3e3e7c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">1</span> Setup</a></li>
  <li><a href="#load-metadata" id="toc-load-metadata" class="nav-link" data-scroll-target="#load-metadata"><span class="header-section-number">2</span> Load metadata</a></li>
  <li><a href="#discover-files-and-build-manifest" id="toc-discover-files-and-build-manifest" class="nav-link" data-scroll-target="#discover-files-and-build-manifest"><span class="header-section-number">3</span> Discover files and build manifest</a></li>
  <li><a href="#load-annual-fullset-and-join-metadata" id="toc-load-annual-fullset-and-join-metadata" class="nav-link" data-scroll-target="#load-annual-fullset-and-join-metadata"><span class="header-section-number">4</span> Load annual FULLSET and join metadata</a></li>
  <li><a href="#igbp-aggregated-flux-summaries" id="toc-igbp-aggregated-flux-summaries" class="nav-link" data-scroll-target="#igbp-aggregated-flux-summaries"><span class="header-section-number">5</span> IGBP aggregated flux summaries</a></li>
  <li><a href="#time-sliced-comparison-5-yr-bins" id="toc-time-sliced-comparison-5-yr-bins" class="nav-link" data-scroll-target="#time-sliced-comparison-5-yr-bins"><span class="header-section-number">6</span> Time-sliced comparison (5-yr bins)</a></li>
  <li><a href="#interannual-boxplots-by-igbp-groups" id="toc-interannual-boxplots-by-igbp-groups" class="nav-link" data-scroll-target="#interannual-boxplots-by-igbp-groups"><span class="header-section-number">7</span> Interannual boxplots by IGBP groups</a></li>
  <li><a href="#median-time-series-by-igbp" id="toc-median-time-series-by-igbp" class="nav-link" data-scroll-target="#median-time-series-by-igbp"><span class="header-section-number">8</span> Median time series by IGBP</a></li>
  <li><a href="#latitudinal-summaries" id="toc-latitudinal-summaries" class="nav-link" data-scroll-target="#latitudinal-summaries"><span class="header-section-number">9</span> Latitudinal summaries</a></li>
  <li><a href="#climate-vs-flux-quicklooks" id="toc-climate-vs-flux-quicklooks" class="nav-link" data-scroll-target="#climate-vs-flux-quicklooks"><span class="header-section-number">10</span> Climate vs Flux quicklooks</a></li>
  <li><a href="#site-level-climate-flux-summaries-tower" id="toc-site-level-climate-flux-summaries-tower" class="nav-link" data-scroll-target="#site-level-climate-flux-summaries-tower"><span class="header-section-number">11</span> Site-level climate &amp; flux summaries (tower)</a></li>
  <li><a href="#worldclim-extraction-at-tower-locations" id="toc-worldclim-extraction-at-tower-locations" class="nav-link" data-scroll-target="#worldclim-extraction-at-tower-locations"><span class="header-section-number">12</span> WorldClim extraction at tower locations</a></li>
  <li><a href="#tower-vs-worldclim-checks" id="toc-tower-vs-worldclim-checks" class="nav-link" data-scroll-target="#tower-vs-worldclim-checks"><span class="header-section-number">13</span> Tower vs WorldClim checks</a></li>
  <li><a href="#whittaker-biomes-with-site-overlays" id="toc-whittaker-biomes-with-site-overlays" class="nav-link" data-scroll-target="#whittaker-biomes-with-site-overlays"><span class="header-section-number">14</span> Whittaker biomes with site overlays</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">FLUXNET Demo Plots</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Moore Lab (SNRE, UA) </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="setup" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>params<span class="sc">$</span>use_terra) {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(raster))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(terra))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotbiomes)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Prevent namespace conflicts with 'raster'</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>filter</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>lag    <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>lag</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Prevent namespace conflicts (e.g., raster::select vs dplyr::select) ---</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Make dplyr verbs explicit so helpers that use unqualified calls get the right ones.</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>select <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>select</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>filter <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>filter</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>lag    <span class="ot">&lt;-</span> dplyr<span class="sc">::</span>lag</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Project helpers</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/fcn_utility_FLUXNET.R"</span>)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/fcn_plot_FLUXNET.R"</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Figure dir + helper</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>fig_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"figs"</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(fig_dir)) <span class="fu">dir.create</span>(fig_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>save_if <span class="ot">&lt;-</span> <span class="cf">function</span>(p, name, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">300</span>) {</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">isTRUE</span>(params<span class="sc">$</span>save_figs)) {</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">file.path</span>(fig_dir, <span class="fu">paste0</span>(name, <span class="st">".png"</span>)), p, <span class="at">width =</span> width, <span class="at">height =</span> height, <span class="at">dpi =</span> dpi)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-metadata" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Load metadata</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">load_fluxnet_metadata</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure 'site' column exists for joins</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="st">"site"</span> <span class="sc">%in%</span> <span class="fu">names</span>(metadata)) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"SITE_ID"</span> <span class="sc">%in%</span> <span class="fu">names</span>(metadata)) metadata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(metadata, <span class="at">site =</span> SITE_ID)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"SITEID"</span>  <span class="sc">%in%</span> <span class="fu">names</span>(metadata)) metadata <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(metadata, <span class="at">site =</span> SITEID)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>md_join <span class="ot">&lt;-</span> metadata <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"SITE_ID"</span>,<span class="st">"SITEID"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="discover-files-and-build-manifest" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Discover files and build manifest</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>amf_files  <span class="ot">&lt;-</span> <span class="fu">discover_AMF_files</span>(<span class="at">data_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(params<span class="sc">$</span>data_dir_amf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• DD / ERA5 → 246 sites, 14121 site-years across 328 files
• DD / FULLSET → 246 sites, 1931 site-years across 328 files
• DD / SUBSET → 1 sites, 17 site-years across 1 files
• HH / ERA5 → 242 sites, 13915 site-years across 323 files
• HH / FULLSET → 242 sites, 1845 site-years across 323 files
• HH / SUBSET → 1 sites, 17 site-years across 1 files
• HR / ERA5 → 4 sites, 206 site-years across 5 files
• HR / FULLSET → 4 sites, 86 site-years across 5 files
• MM / ERA5 → 246 sites, 14121 site-years across 328 files
• MM / FULLSET → 246 sites, 1931 site-years across 328 files
• MM / SUBSET → 1 sites, 17 site-years across 1 files
• WW / ERA5 → 246 sites, 14121 site-years across 328 files
• WW / FULLSET → 246 sites, 1931 site-years across 328 files
• WW / SUBSET → 1 sites, 17 site-years across 1 files
• YY / ERA5 → 246 sites, 14121 site-years across 328 files
• YY / FULLSET → 246 sites, 1931 site-years across 328 files
• YY / SUBSET → 1 sites, 17 site-years across 1 files</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>icos_files <span class="ot">&lt;-</span> <span class="fu">discover_ICOS_files</span>(<span class="at">data_dir =</span> here<span class="sc">::</span><span class="fu">here</span>(params<span class="sc">$</span>data_dir_icos))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>• AUXMETEO / L2 → 70 sites, 0 total site-years across 70 files
• AUXNEE / L2 → 70 sites, 0 total site-years across 70 files
• DD / FULLSET → 149 sites, 1071 total site-years across 149 files
• DD / L2 → 70 sites, 0 total site-years across 70 files
• HH / FULLSET → 141 sites, 961 total site-years across 141 files
• HH / L2 → 70 sites, 0 total site-years across 70 files
• MM / L2 → 70 sites, 0 total site-years across 70 files
• WW / FULLSET → 149 sites, 1071 total site-years across 149 files
• WW / L2 → 70 sites, 0 total site-years across 70 files
• YY / FULLSET → 149 sites, 1071 total site-years across 149 files
• YY / L2 → 70 sites, 0 total site-years across 70 files
• YY / SUBSET → 206 sites, 1493 total site-years across 206 files
• YY_INTERIM / L2 → 39 sites, 0 total site-years across 39 files</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>manifest <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(amf_files, icos_files) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(site, data_product, dataset, time_integral, start_year, end_year, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>manifest <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">count</span>(dataset, time_integral)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 3
   dataset time_integral     n
   &lt;chr&gt;   &lt;chr&gt;         &lt;int&gt;
 1 ERA5    DD              328
 2 ERA5    HH              323
 3 ERA5    HR                5
 4 ERA5    MM              328
 5 ERA5    WW              328
 6 ERA5    YY              328
 7 FULLSET DD              432
 8 FULLSET HH              420
 9 FULLSET HR                4
10 FULLSET MM              283
# ℹ 15 more rows</code></pre>
</div>
</div>
</section>
<section id="load-annual-fullset-and-join-metadata" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Load annual FULLSET and join metadata</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>annual_data <span class="ot">&lt;-</span> manifest <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(time_integral <span class="sc">==</span> <span class="st">"YY"</span>, dataset <span class="sc">==</span> <span class="st">"FULLSET"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load_fluxnet_data</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span><span class="fu">na_if</span>(.x, <span class="sc">-</span><span class="dv">9999</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(TIMESTAMP), <span class="at">.before =</span> TIMESTAMP) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(md_join, <span class="at">by =</span> <span class="st">"site"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(annual_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,832
Columns: 383
$ path                           &lt;fs::path&gt; "/Users/davidmoore/Documents/RProj…
$ year                           &lt;int&gt; 2012, 2013, 2012, 2013, 2014, 2015, 201…
$ TIMESTAMP                      &lt;dbl&gt; 2012, 2013, 2012, 2013, 2014, 2015, 201…
$ TA_F_MDS                       &lt;dbl&gt; NA, NA, NA, 16.171, 16.818, 16.987, 16.…
$ TA_F_MDS_QC                    &lt;dbl&gt; NA, NA, NA, 0.992180, 0.753824, 0.34223…
$ TA_F_MDS_NIGHT                 &lt;dbl&gt; NA, NA, NA, 13.787, 14.547, 14.122, 14.…
$ TA_F_MDS_NIGHT_SD              &lt;dbl&gt; NA, NA, NA, 2.149, 2.217, 2.350, 2.172,…
$ TA_F_MDS_NIGHT_QC              &lt;dbl&gt; NA, NA, NA, 0.994977, 0.754906, 0.34435…
$ TA_F_MDS_DAY                   &lt;dbl&gt; NA, NA, NA, 18.339, 18.870, 19.646, 19.…
$ TA_F_MDS_DAY_SD                &lt;dbl&gt; NA, NA, NA, 3.534, 3.467, 4.084, 3.553,…
$ TA_F_MDS_DAY_QC                &lt;dbl&gt; NA, NA, NA, 0.990169, 0.752377, 0.34050…
$ TA_ERA                         &lt;dbl&gt; 13.491, 13.184, 16.889, 16.720, 16.938,…
$ TA_ERA_NIGHT                   &lt;dbl&gt; 11.565, 11.187, 15.369, 15.021, 15.421,…
$ TA_ERA_NIGHT_SD                &lt;dbl&gt; 2.524, 2.628, 2.276, 2.452, 2.264, 2.21…
$ TA_ERA_DAY                     &lt;dbl&gt; 15.171, 14.944, 18.256, 18.248, 18.295,…
$ TA_ERA_DAY_SD                  &lt;dbl&gt; 3.601, 3.929, 3.457, 3.970, 3.554, 3.57…
$ TA_F                           &lt;dbl&gt; 13.491, 13.172, 16.904, 16.149, 16.658,…
$ TA_F_QC                        &lt;dbl&gt; 0.000000, 0.251256, 0.163593, 0.992180,…
$ TA_F_NIGHT                     &lt;dbl&gt; 11.565, 10.874, 15.351, 13.779, 14.582,…
$ TA_F_NIGHT_SD                  &lt;dbl&gt; 2.524, 2.511, 2.249, 2.157, 2.279, 2.26…
$ TA_F_NIGHT_QC                  &lt;dbl&gt; 0.000000, 0.260769, 0.164208, 0.994977,…
$ TA_F_DAY                       &lt;dbl&gt; 15.171, 15.164, 18.291, 18.307, 18.542,…
$ TA_F_DAY_SD                    &lt;dbl&gt; 3.601, 3.994, 3.413, 3.538, 3.443, 3.64…
$ TA_F_DAY_QC                    &lt;dbl&gt; 0.000000, 0.243699, 0.163154, 0.990169,…
$ SW_IN_F_MDS                    &lt;dbl&gt; NA, NA, NA, 189.029, 298.360, 236.156, …
$ SW_IN_F_MDS_QC                 &lt;dbl&gt; NA, NA, NA, 9.11815e-01, 0.00000e+00, 5…
$ SW_IN_ERA                      &lt;dbl&gt; 142.402, 146.403, 139.227, 146.471, 137…
$ SW_IN_F                        &lt;dbl&gt; 142.402, 146.824, 151.562, 183.101, 137…
$ SW_IN_F_QC                     &lt;dbl&gt; 0.00000e+00, 2.50285e-01, 1.63707e-01, …
$ LW_IN_F_MDS                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LW_IN_F_MDS_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LW_IN_ERA                      &lt;dbl&gt; 321.684, 317.226, 331.056, 324.067, 329…
$ LW_IN_F                        &lt;dbl&gt; 321.684, 317.226, 331.056, 324.067, 329…
$ LW_IN_F_QC                     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ LW_IN_JSB                      &lt;dbl&gt; NA, NA, NA, 363.230, 340.457, 343.340, …
$ LW_IN_JSB_QC                   &lt;dbl&gt; NA, NA, NA, 9.09989e-01, 0.00000e+00, 5…
$ LW_IN_JSB_ERA                  &lt;dbl&gt; 369.530, 365.447, 386.675, 379.984, 385…
$ LW_IN_JSB_F                    &lt;dbl&gt; 369.530, 365.386, 385.252, 363.281, 385…
$ LW_IN_JSB_F_QC                 &lt;dbl&gt; 0.00000e+00, 2.49372e-01, 1.63593e-01, …
$ VPD_F_MDS                      &lt;dbl&gt; NA, NA, NA, 6.410, 5.346, 7.118, 9.420,…
$ VPD_F_MDS_QC                   &lt;dbl&gt; NA, NA, NA, 0.988527, 0.677911, 0.25291…
$ VPD_ERA                        &lt;dbl&gt; 5.152, 5.670, 5.759, 6.895, 5.910, 6.00…
$ VPD_F                          &lt;dbl&gt; 5.152, 5.666, 6.072, 6.416, 5.432, 5.89…
$ VPD_F_QC                       &lt;dbl&gt; 0.0000000, 0.2512560, 0.1635930, 0.9885…
$ PA_ERA                         &lt;dbl&gt; 99.874, 99.918, 100.410, 100.482, 100.4…
$ PA_F                           &lt;dbl&gt; 99.873, 99.920, 100.420, 100.522, 100.4…
$ PA_F_QC                        &lt;dbl&gt; 0.0119536, 0.1960050, 0.1607470, 0.8840…
$ P_ERA                          &lt;dbl&gt; 515.755, 349.299, 4405.991, 2382.798, 4…
$ P_F                            &lt;dbl&gt; 515.755, 349.294, 4405.991, 2382.798, 4…
$ P_F_QC                         &lt;dbl&gt; 0.000000, 0.234989, 0.000000, 0.000000,…
$ WS_ERA                         &lt;dbl&gt; 2.800, 2.893, 2.592, 2.634, 2.628, 2.53…
$ WS_F                           &lt;dbl&gt; 2.800, 2.876, 2.679, 2.569, 2.578, 2.47…
$ WS_F_QC                        &lt;dbl&gt; 0.000000, 0.234989, 0.160747, 0.884018,…
$ USTAR                          &lt;dbl&gt; NA, NA, NA, 0.2475940, 0.2467583, NA, 0…
$ USTAR_QC                       &lt;dbl&gt; NA, NA, NA, 0.8769977, 0.7378425, NA, 0…
$ PPFD_IN                        &lt;dbl&gt; NA, NA, NA, 342.1824, NA, NA, 199.2228,…
$ PPFD_IN_QC                     &lt;dbl&gt; NA, NA, NA, 0.9110731, NA, NA, 1.000000…
$ CO2_F_MDS                      &lt;dbl&gt; NA, NA, NA, 417.488, 426.519, 374.656, …
$ CO2_F_MDS_QC                   &lt;dbl&gt; NA, NA, NA, 0.986587, 0.688014, 0.25456…
$ TS_F_MDS_1                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_2                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_3                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_4                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_5                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_1_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_2_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_3_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_4_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_5_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ G_F_MDS                        &lt;dbl&gt; 12.13060, -2.52508, NA, NA, NA, NA, NA,…
$ G_F_MDS_QC                     &lt;dbl&gt; 0.000000, 0.251256, NA, NA, NA, NA, NA,…
$ LE_F_MDS                       &lt;dbl&gt; 82.5238, 72.9260, 61.1190, 61.2237, 64.…
$ LE_F_MDS_QC                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LE_CORR                        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LE_RANDUNC                     &lt;dbl&gt; 3.438640, 0.491970, 0.560090, 0.178788,…
$ H_F_MDS                        &lt;dbl&gt; 80.62270, 25.71070, 64.31060, 29.37260,…
$ H_F_MDS_QC                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ H_CORR                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ H_RANDUNC                      &lt;dbl&gt; 1.684030, 0.287774, 0.468910, 0.180725,…
$ EBC_CF_N                       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ EBC_CF_METHOD                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ NIGHT_RANDUNC_N                &lt;dbl&gt; 0.068306, 6.224660, 3.806010, 22.145200…
$ DAY_RANDUNC_N                  &lt;dbl&gt; 0.114754, 7.758900, 5.795080, 23.306800…
$ NEE_VUT_REF                    &lt;dbl&gt; 49.5379, -372.3980, 691.6200, -415.7750…
$ NEE_VUT_REF_QC                 &lt;dbl&gt; 0.0104167, 0.2476600, 0.1622270, 0.9578…
$ NEE_VUT_REF_RANDUNC            &lt;dbl&gt; 97.488300, 17.902100, 11.259900, 5.7960…
$ NEE_VUT_REF_JOINTUNC           &lt;dbl&gt; 111.80800, 153.26500, 30.06430, 6.40125…
$ NEE_VUT_USTAR50                &lt;dbl&gt; 24.87610, -432.93500, 652.48000, -413.4…
$ NEE_VUT_USTAR50_QC             &lt;dbl&gt; 0.0118966, 0.2510840, 0.1624540, 0.9622…
$ NEE_VUT_USTAR50_RANDUNC        &lt;dbl&gt; 105.657000, 19.471600, 11.516100, 5.810…
$ NEE_VUT_USTAR50_JOINTUNC       &lt;dbl&gt; 118.99700, 153.45600, 30.16120, 6.41438…
$ NEE_VUT_MEAN                   &lt;dbl&gt; 59.55210, -435.04200, 664.18800, -413.9…
$ NEE_VUT_MEAN_QC                &lt;dbl&gt; 0.0110599, 0.2482320, 0.1623160, 0.9614…
$ NEE_VUT_SE                     &lt;dbl&gt; 11.348200, 18.951100, 4.750380, 0.88218…
$ NEE_VUT_05                     &lt;dbl&gt; 4.8730, -562.8260, 633.0960, -419.6340,…
$ NEE_VUT_16                     &lt;dbl&gt; 24.4716, -561.6660, 635.8680, -417.7240…
$ NEE_VUT_25                     &lt;dbl&gt; 24.4716, -561.0590, 641.2010, -416.2320…
$ NEE_VUT_50                     &lt;dbl&gt; 24.87610, -433.16800, 658.25300, -414.4…
$ NEE_VUT_75                     &lt;dbl&gt; 49.50060, -372.39800, 686.91800, -413.1…
$ NEE_VUT_84                     &lt;dbl&gt; 133.96200, -257.23400, 691.62000, -412.…
$ NEE_VUT_95                     &lt;dbl&gt; 212.03200, -233.83300, 702.68000, -409.…
$ NEE_VUT_05_QC                  &lt;dbl&gt; 0.010872, 0.251313, 0.162910, 0.956336,…
$ NEE_VUT_16_QC                  &lt;dbl&gt; 0.0119536, 0.2513130, 0.1628530, 0.9763…
$ NEE_VUT_25_QC                  &lt;dbl&gt; 0.0119536, 0.2513700, 0.1629100, 0.9645…
$ NEE_VUT_50_QC                  &lt;dbl&gt; 0.0118966, 0.2510840, 0.1627960, 0.9628…
$ NEE_VUT_75_QC                  &lt;dbl&gt; 0.0104167, 0.2476600, 0.1614300, 0.9681…
$ NEE_VUT_84_QC                  &lt;dbl&gt; 0.00956284, 0.23989700, 0.16222700, 0.9…
$ NEE_VUT_95_QC                  &lt;dbl&gt; 0.00842441, 0.24138100, 0.16114500, 0.9…
$ NEE_VUT_REF_NIGHT              &lt;dbl&gt; 1.6102900, 3.2423000, 2.8715100, 3.4062…
$ NEE_VUT_REF_NIGHT_SD           &lt;dbl&gt; 0.828242, 2.180850, 1.148330, 1.144790,…
$ NEE_VUT_REF_NIGHT_QC           &lt;dbl&gt; 0.00880389, 0.26808500, 0.16390400, 0.9…
$ NEE_VUT_REF_NIGHT_RANDUNC      &lt;dbl&gt; 0.33076500, 0.05208610, 0.04435400, 0.0…
$ NEE_VUT_REF_NIGHT_JOINTUNC     &lt;dbl&gt; 0.45078300, 0.97028100, 0.11029100, 0.0…
$ NEE_VUT_REF_DAY                &lt;dbl&gt; -1.264970, -5.028240, 0.965229, -4.7746…
$ NEE_VUT_REF_DAY_SD             &lt;dbl&gt; 1.097380, 3.839780, 0.827990, 4.925190,…
$ NEE_VUT_REF_DAY_QC             &lt;dbl&gt; 0.0113843, 0.2334540, 0.1610950, 0.9663…
$ NEE_VUT_REF_DAY_RANDUNC        &lt;dbl&gt; 0.37282400, 0.07421390, 0.04096390, 0.0…
$ NEE_VUT_REF_DAY_JOINTUNC       &lt;dbl&gt; 0.37282500, 0.19365700, 0.06311110, 0.0…
$ NEE_VUT_USTAR50_NIGHT          &lt;dbl&gt; 1.47135000, 2.93095000, 2.69457000, 3.4…
$ NEE_VUT_USTAR50_NIGHT_SD       &lt;dbl&gt; 0.769280, 2.123830, 0.655893, 1.163030,…
$ NEE_VUT_USTAR50_NIGHT_QC       &lt;dbl&gt; 0.0124469, 0.2733020, 0.1639040, 0.9480…
$ NEE_VUT_USTAR50_NIGHT_RANDUNC  &lt;dbl&gt; 0.40294000, 0.06559290, 0.04416520, 0.0…
$ NEE_VUT_USTAR50_NIGHT_JOINTUNC &lt;dbl&gt; 0.50612300, 0.97110000, 0.11021500, 0.0…
$ NEE_VUT_USTAR50_DAY            &lt;dbl&gt; -1.265540, -5.044550, 0.934960, -4.7845…
$ NEE_VUT_USTAR50_DAY_SD         &lt;dbl&gt; 1.097830, 3.803960, 0.833281, 4.951610,…
$ NEE_VUT_USTAR50_DAY_QC         &lt;dbl&gt; 0.0115665, 0.2348710, 0.1614600, 0.9688…
$ NEE_VUT_USTAR50_DAY_RANDUNC    &lt;dbl&gt; 0.37337400, 0.07625530, 0.04100870, 0.0…
$ NEE_VUT_USTAR50_DAY_JOINTUNC   &lt;dbl&gt; 0.37337400, 0.19444800, 0.06314020, 0.0…
$ NEE_VUT_05_NIGHT               &lt;dbl&gt; 1.361110, 2.194270, 2.639930, 3.398190,…
$ NEE_VUT_16_NIGHT               &lt;dbl&gt; 1.468510, 2.206320, 2.668280, 3.412150,…
$ NEE_VUT_25_NIGHT               &lt;dbl&gt; 1.468510, 2.215690, 2.683880, 3.416000,…
$ NEE_VUT_50_NIGHT               &lt;dbl&gt; 1.4707400, 2.9300400, 2.7151900, 3.4262…
$ NEE_VUT_75_NIGHT               &lt;dbl&gt; 1.610290, 3.242300, 2.835590, 3.437270,…
$ NEE_VUT_84_NIGHT               &lt;dbl&gt; 2.081050, 4.144090, 2.870240, 3.440440,…
$ NEE_VUT_95_NIGHT               &lt;dbl&gt; 2.491770, 4.428190, 2.880660, 3.449330,…
$ NEE_VUT_05_NIGHT_QC            &lt;dbl&gt; 0.00986642, 0.27405900, 0.16420800, 0.9…
$ NEE_VUT_16_NIGHT_QC            &lt;dbl&gt; 0.0125987, 0.2738300, 0.1642080, 0.9523…
$ NEE_VUT_25_NIGHT_QC            &lt;dbl&gt; 0.0125987, 0.2738300, 0.1642080, 0.9448…
$ NEE_VUT_50_NIGHT_QC            &lt;dbl&gt; 0.0125987, 0.2733020, 0.1640560, 0.9530…
$ NEE_VUT_75_NIGHT_QC            &lt;dbl&gt; 0.00880389, 0.26808500, 0.16390400, 0.9…
$ NEE_VUT_84_NIGHT_QC            &lt;dbl&gt; 0.00743777, 0.26464000, 0.16390400, 0.9…
$ NEE_VUT_95_NIGHT_QC            &lt;dbl&gt; 0.00531269, 0.25915000, 0.16390400, 0.9…
$ NEE_VUT_05_DAY                 &lt;dbl&gt; -1.265580, -5.470700, 0.871021, -4.7951…
$ NEE_VUT_16_DAY                 &lt;dbl&gt; -1.265540, -5.391480, 0.876671, -4.7913…
$ NEE_VUT_25_DAY                 &lt;dbl&gt; -1.265540, -5.050360, 0.915892, -4.7886…
$ NEE_VUT_50_DAY                 &lt;dbl&gt; -1.265470, -5.041780, 0.945197, -4.7860…
$ NEE_VUT_75_DAY                 &lt;dbl&gt; -1.264850, -5.036750, 0.965854, -4.7819…
$ NEE_VUT_84_DAY                 &lt;dbl&gt; -1.264290, -5.033740, 0.972692, -4.7754…
$ NEE_VUT_95_DAY                 &lt;dbl&gt; -1.248380, -5.028950, 0.997265, -4.7727…
$ NEE_VUT_05_DAY_QC              &lt;dbl&gt; 0.0114754, 0.2253410, 0.1620190, 0.9718…
$ NEE_VUT_16_DAY_QC              &lt;dbl&gt; 0.0115665, 0.2298420, 0.1619280, 0.9727…
$ NEE_VUT_25_DAY_QC              &lt;dbl&gt; 0.0115665, 0.2347630, 0.1620190, 0.9693…
$ NEE_VUT_50_DAY_QC              &lt;dbl&gt; 0.0114754, 0.2349770, 0.1618300, 0.9681…
$ NEE_VUT_75_DAY_QC              &lt;dbl&gt; 0.0116576, 0.2343600, 0.1614600, 0.9660…
$ NEE_VUT_84_DAY_QC              &lt;dbl&gt; 0.0116576, 0.2347460, 0.1609070, 0.9667…
$ NEE_VUT_95_DAY_QC              &lt;dbl&gt; 0.0102914, 0.2321700, 0.1589750, 0.9577…
$ RECO_NT_VUT_REF                &lt;dbl&gt; NA, 1.16590e+03, 1.13394e+03, 1.42800e+…
$ RECO_NT_VUT_USTAR50            &lt;dbl&gt; NA, 1.28501e+03, 1.10507e+03, 1.43468e+…
$ RECO_NT_VUT_MEAN               &lt;dbl&gt; NA, 1351.11000, 1144.03000, 1439.39000,…
$ RECO_NT_VUT_SE                 &lt;dbl&gt; NA, 29.376800, 11.729000, 1.995490, 39.…
$ RECO_NT_VUT_05                 &lt;dbl&gt; NA, 1.18523e+03, 9.79631e+02, 1.42566e+…
$ RECO_NT_VUT_16                 &lt;dbl&gt; NA, 1.21181e+03, 1.00471e+03, 1.43174e+…
$ RECO_NT_VUT_25                 &lt;dbl&gt; NA, 1.23791e+03, 1.13394e+03, 1.43323e+…
$ RECO_NT_VUT_50                 &lt;dbl&gt; NA, 1.28467e+03, 1.16646e+03, 1.43567e+…
$ RECO_NT_VUT_75                 &lt;dbl&gt; NA, 1.35709e+03, 1.18347e+03, 1.44157e+…
$ RECO_NT_VUT_84                 &lt;dbl&gt; NA, 1.40899e+03, 1.19136e+03, 1.44779e+…
$ RECO_NT_VUT_95                 &lt;dbl&gt; NA, 1.78738e+03, 1.21298e+03, 1.45640e+…
$ GPP_NT_VUT_REF                 &lt;dbl&gt; NA, 1732.870, 483.005, 1848.410, 216.18…
$ GPP_NT_VUT_USTAR50             &lt;dbl&gt; NA, 1717.950, 452.589, 1848.170, 205.96…
$ GPP_NT_VUT_MEAN                &lt;dbl&gt; NA, 1786.150, 479.844, 1853.320, 604.73…
$ GPP_NT_VUT_SE                  &lt;dbl&gt; NA, 16.717500, 10.199800, 1.417720, 221…
$ GPP_NT_VUT_05                  &lt;dbl&gt; NA, 1651.880, 338.115, 1842.660, 20.841…
$ GPP_NT_VUT_16                  &lt;dbl&gt; NA, 1717.8900, 371.2930, 1845.9300, 83.…
$ GPP_NT_VUT_25                  &lt;dbl&gt; NA, 1722.580, 478.842, 1848.310, 132.37…
$ GPP_NT_VUT_50                  &lt;dbl&gt; NA, 1772.500, 494.934, 1850.230, 152.56…
$ GPP_NT_VUT_75                  &lt;dbl&gt; NA, 1799.070, 511.273, 1854.030, 206.72…
$ GPP_NT_VUT_84                  &lt;dbl&gt; NA, 1813.010, 525.356, 1858.680, 217.16…
$ GPP_NT_VUT_95                  &lt;dbl&gt; NA, 2044.610, 530.589, 1871.840, 4230.6…
$ RECO_DT_VUT_REF                &lt;dbl&gt; NA, 796.754, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_USTAR50            &lt;dbl&gt; NA, 864.574, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_MEAN               &lt;dbl&gt; NA, 1221.390, NA, NA, NA, NA, NA, NA, N…
$ RECO_DT_VUT_SE                 &lt;dbl&gt; NA, 115.48500, NA, NA, NA, NA, NA, NA, …
$ RECO_DT_VUT_05                 &lt;dbl&gt; NA, 798.322, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_16                 &lt;dbl&gt; NA, 805.297, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_25                 &lt;dbl&gt; NA, 812.776, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_50                 &lt;dbl&gt; NA, 865.662, NA, NA, NA, NA, NA, NA, NA…
$ RECO_DT_VUT_75                 &lt;dbl&gt; NA, 1217.670, NA, NA, NA, NA, NA, NA, N…
$ RECO_DT_VUT_84                 &lt;dbl&gt; NA, 1769.760, NA, NA, NA, NA, NA, NA, N…
$ RECO_DT_VUT_95                 &lt;dbl&gt; NA, 2888.700, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_REF                 &lt;dbl&gt; NA, 1.20523e+03, NA, NA, NA, NA, NA, NA…
$ GPP_DT_VUT_USTAR50             &lt;dbl&gt; NA, 1118.630, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_MEAN                &lt;dbl&gt; NA, 1349.330000, NA, NA, NA, NA, NA, NA…
$ GPP_DT_VUT_SE                  &lt;dbl&gt; NA, 63.9824000, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_VUT_05                  &lt;dbl&gt; NA, 1115.540, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_16                  &lt;dbl&gt; NA, 1121.230, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_25                  &lt;dbl&gt; NA, 1147.580, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_50                  &lt;dbl&gt; NA, 1198.570, NA, NA, NA, NA, NA, NA, N…
$ GPP_DT_VUT_75                  &lt;dbl&gt; NA, 1.23244e+03, NA, NA, NA, NA, NA, NA…
$ GPP_DT_VUT_84                  &lt;dbl&gt; NA, 1.61412e+03, NA, NA, NA, NA, NA, NA…
$ GPP_DT_VUT_95                  &lt;dbl&gt; NA, 2372.030000, NA, NA, NA, NA, NA, NA…
$ NEE_CUT_REF                    &lt;dbl&gt; NA, NA, 657.7020, -413.4930, NA, NA, -5…
$ NEE_CUT_REF_QC                 &lt;dbl&gt; NA, NA, 0.162568, 0.964155, NA, NA, 0.2…
$ NEE_CUT_REF_RANDUNC            &lt;dbl&gt; NA, NA, 11.524200, 5.872620, NA, NA, 21…
$ NEE_CUT_REF_JOINTUNC           &lt;dbl&gt; NA, NA, 27.56840, 7.17939, NA, NA, 27.1…
$ NEE_CUT_USTAR50                &lt;dbl&gt; NA, NA, 659.52800, -418.70200, NA, NA, …
$ NEE_CUT_USTAR50_QC             &lt;dbl&gt; NA, NA, 0.162568, 0.964555, NA, NA, 0.2…
$ NEE_CUT_USTAR50_RANDUNC        &lt;dbl&gt; NA, NA, 11.476000, 5.995410, NA, NA, 21…
$ NEE_CUT_USTAR50_JOINTUNC       &lt;dbl&gt; NA, NA, 27.54830, 7.28018, NA, NA, 26.7…
$ NEE_CUT_MEAN                   &lt;dbl&gt; NA, NA, 607.84500, -395.38500, NA, NA, …
$ NEE_CUT_MEAN_QC                &lt;dbl&gt; NA, NA, 0.159866, 0.934459, NA, NA, 0.2…
$ NEE_CUT_SE                     &lt;dbl&gt; NA, NA, 28.227000, 10.536600, NA, NA, 3…
$ NEE_CUT_05                     &lt;dbl&gt; NA, NA, 37.2929, -419.7930, NA, NA, -12…
$ NEE_CUT_16                     &lt;dbl&gt; NA, NA, 633.0960, -418.2170, NA, NA, -5…
$ NEE_CUT_25                     &lt;dbl&gt; NA, NA, 635.5460, -416.1510, NA, NA, -5…
$ NEE_CUT_50                     &lt;dbl&gt; NA, NA, 655.08200, -413.95400, NA, NA, …
$ NEE_CUT_75                     &lt;dbl&gt; NA, NA, 659.15800, -411.86700, NA, NA, …
$ NEE_CUT_84                     &lt;dbl&gt; NA, NA, 683.18400, -409.95700, NA, NA, …
$ NEE_CUT_95                     &lt;dbl&gt; NA, NA, 692.18000, -208.01800, NA, NA, …
$ NEE_CUT_05_QC                  &lt;dbl&gt; NA, NA, 0.127960, 0.965411, NA, NA, 0.1…
$ NEE_CUT_16_QC                  &lt;dbl&gt; NA, NA, 0.162910, 0.956621, NA, NA, 0.2…
$ NEE_CUT_25_QC                  &lt;dbl&gt; NA, NA, 0.162796, 0.960274, NA, NA, 0.2…
$ NEE_CUT_50_QC                  &lt;dbl&gt; NA, NA, 0.1627960, 0.9634700, NA, NA, 0…
$ NEE_CUT_75_QC                  &lt;dbl&gt; NA, NA, 0.162568, 0.970776, NA, NA, 0.2…
$ NEE_CUT_84_QC                  &lt;dbl&gt; NA, NA, 0.162113, 0.969349, NA, NA, 0.2…
$ NEE_CUT_95_QC                  &lt;dbl&gt; NA, NA, 0.162341, 0.461358, NA, NA, 0.2…
$ NEE_CUT_REF_NIGHT              &lt;dbl&gt; NA, NA, 2.7176700, 3.4343400, NA, NA, 5…
$ NEE_CUT_REF_NIGHT_SD           &lt;dbl&gt; NA, NA, 0.715438, 1.237300, NA, NA, 1.9…
$ NEE_CUT_REF_NIGHT_QC           &lt;dbl&gt; NA, NA, 0.1640560, 0.9509820, NA, NA, 0…
$ NEE_CUT_REF_NIGHT_RANDUNC      &lt;dbl&gt; NA, NA, 0.04433190, 0.01865660, NA, NA,…
$ NEE_CUT_REF_NIGHT_JOINTUNC     &lt;dbl&gt; NA, NA, 0.10817600, 0.02558820, NA, NA,…
$ NEE_CUT_REF_DAY                &lt;dbl&gt; NA, NA, 0.940298, -4.784160, NA, NA, -7…
$ NEE_CUT_REF_DAY_SD             &lt;dbl&gt; NA, NA, 0.845309, 4.973300, NA, NA, 6.9…
$ NEE_CUT_REF_DAY_QC             &lt;dbl&gt; NA, NA, 0.161551, 0.970533, NA, NA, 0.2…
$ NEE_CUT_REF_DAY_RANDUNC        &lt;dbl&gt; NA, NA, 0.04097980, 0.02449400, NA, NA,…
$ NEE_CUT_REF_DAY_JOINTUNC       &lt;dbl&gt; NA, NA, 0.06311670, 0.02536940, NA, NA,…
$ NEE_CUT_USTAR50_NIGHT          &lt;dbl&gt; NA, NA, 2.7209300, 3.4171800, NA, NA, 5…
$ NEE_CUT_USTAR50_NIGHT_SD       &lt;dbl&gt; NA, NA, 0.712021, 1.256350, NA, NA, 1.9…
$ NEE_CUT_USTAR50_NIGHT_QC       &lt;dbl&gt; NA, NA, 0.1640560, 0.9518960, NA, NA, 0…
$ NEE_CUT_USTAR50_NIGHT_RANDUNC  &lt;dbl&gt; NA, NA, 0.04416770, 0.01895860, NA, NA,…
$ NEE_CUT_USTAR50_NIGHT_JOINTUNC &lt;dbl&gt; NA, NA, 0.10810900, 0.02580920, NA, NA,…
$ NEE_CUT_USTAR50_DAY            &lt;dbl&gt; NA, NA, 0.946015, -4.794740, NA, NA, -7…
$ NEE_CUT_USTAR50_DAY_SD         &lt;dbl&gt; NA, NA, 0.847054, 4.996170, NA, NA, 6.9…
$ NEE_CUT_USTAR50_DAY_QC         &lt;dbl&gt; NA, NA, 0.161551, 0.970670, NA, NA, 0.2…
$ NEE_CUT_USTAR50_DAY_RANDUNC    &lt;dbl&gt; NA, NA, 0.04079840, 0.02506720, NA, NA,…
$ NEE_CUT_USTAR50_DAY_JOINTUNC   &lt;dbl&gt; NA, NA, 0.06299900, 0.02592330, NA, NA,…
$ NEE_CUT_05_NIGHT               &lt;dbl&gt; NA, NA, -0.791902, 3.400800, NA, NA, 3.…
$ NEE_CUT_16_NIGHT               &lt;dbl&gt; NA, NA, 2.621850, 3.414300, NA, NA, 5.2…
$ NEE_CUT_25_NIGHT               &lt;dbl&gt; NA, NA, 2.664320, 3.418130, NA, NA, 5.3…
$ NEE_CUT_50_NIGHT               &lt;dbl&gt; NA, NA, 2.69630000, 3.43140000, NA, NA,…
$ NEE_CUT_75_NIGHT               &lt;dbl&gt; NA, NA, 2.718890, 3.440160, NA, NA, 5.4…
$ NEE_CUT_84_NIGHT               &lt;dbl&gt; NA, NA, 2.819200, 3.449330, NA, NA, 5.4…
$ NEE_CUT_95_NIGHT               &lt;dbl&gt; NA, NA, 2.871180, 4.702330, NA, NA, 5.4…
$ NEE_CUT_05_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1299670, 0.9370590, NA, NA, 0…
$ NEE_CUT_16_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1642080, 0.9523680, NA, NA, 0…
$ NEE_CUT_25_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1642080, 0.9445790, NA, NA, 0…
$ NEE_CUT_50_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1639040, 0.9514390, NA, NA, 0…
$ NEE_CUT_75_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1640560, 0.9567490, NA, NA, 0…
$ NEE_CUT_84_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1639040, 0.9582710, NA, NA, 0…
$ NEE_CUT_95_NIGHT_QC            &lt;dbl&gt; NA, NA, 0.1639040, 0.4205090, NA, NA, 0…
$ NEE_CUT_05_DAY                 &lt;dbl&gt; NA, NA, 0.871021, -4.918470, NA, NA, -1…
$ NEE_CUT_16_DAY                 &lt;dbl&gt; NA, NA, 0.876663, -4.794380, NA, NA, -7…
$ NEE_CUT_25_DAY                 &lt;dbl&gt; NA, NA, 0.899652, -4.791480, NA, NA, -7…
$ NEE_CUT_50_DAY                 &lt;dbl&gt; NA, NA, 0.940292, -4.787520, NA, NA, -7…
$ NEE_CUT_75_DAY                 &lt;dbl&gt; NA, NA, 0.965854, -4.782560, NA, NA, -7…
$ NEE_CUT_84_DAY                 &lt;dbl&gt; NA, NA, 0.972671, -4.781170, NA, NA, -7…
$ NEE_CUT_95_DAY                 &lt;dbl&gt; NA, NA, 1.233310, -4.772540, NA, NA, -7…
$ NEE_CUT_05_DAY_QC              &lt;dbl&gt; NA, NA, 0.162019, 0.601978, NA, NA, 0.1…
$ NEE_CUT_16_DAY_QC              &lt;dbl&gt; NA, NA, 0.161921, 0.979988, NA, NA, 0.2…
$ NEE_CUT_25_DAY_QC              &lt;dbl&gt; NA, NA, 0.162214, 0.973910, NA, NA, 0.2…
$ NEE_CUT_50_DAY_QC              &lt;dbl&gt; NA, NA, 0.162117, 0.973331, NA, NA, 0.2…
$ NEE_CUT_75_DAY_QC              &lt;dbl&gt; NA, NA, 0.161460, 0.974993, NA, NA, 0.2…
$ NEE_CUT_84_DAY_QC              &lt;dbl&gt; NA, NA, 0.160907, 0.977260, NA, NA, 0.2…
$ NEE_CUT_95_DAY_QC              &lt;dbl&gt; NA, NA, 0.110966, 0.966811, NA, NA, 0.2…
$ RECO_NT_CUT_REF                &lt;dbl&gt; NA, NA, 9.95379e+02, 1.42283e+03, 2.019…
$ RECO_NT_CUT_USTAR50            &lt;dbl&gt; NA, NA, 1.18703e+03, 1.42869e+03, 2.148…
$ RECO_NT_CUT_MEAN               &lt;dbl&gt; NA, NA, 1127.96000, 1485.06000, 2034.62…
$ RECO_NT_CUT_SE                 &lt;dbl&gt; NA, NA, 16.382800, 26.248100, 44.019300…
$ RECO_NT_CUT_05                 &lt;dbl&gt; NA, NA, 9.78202e+02, 1.42512e+03, 1.496…
$ RECO_NT_CUT_16                 &lt;dbl&gt; NA, NA, 9.90060e+02, 1.43165e+03, 1.531…
$ RECO_NT_CUT_25                 &lt;dbl&gt; NA, NA, 1.00471e+03, 1.43222e+03, 2.041…
$ RECO_NT_CUT_50                 &lt;dbl&gt; NA, NA, 1.16386e+03, 1.43574e+03, 2.147…
$ RECO_NT_CUT_75                 &lt;dbl&gt; NA, NA, 1.18180e+03, 1.44517e+03, 2.175…
$ RECO_NT_CUT_84                 &lt;dbl&gt; NA, NA, 1.18481e+03, 1.45476e+03, 2.188…
$ RECO_NT_CUT_95                 &lt;dbl&gt; NA, NA, 1231.78000, 1887.61000, 2191.95…
$ GPP_NT_CUT_REF                 &lt;dbl&gt; NA, NA, 474.780, 1847.230, 651.112, 651…
$ GPP_NT_CUT_USTAR50             &lt;dbl&gt; NA, NA, 527.506, 1847.390, 642.489, 642…
$ GPP_NT_CUT_MEAN                &lt;dbl&gt; NA, NA, 520.112, 1880.440, -216.154, -2…
$ GPP_NT_CUT_SE                  &lt;dbl&gt; NA, NA, 34.164500, 16.823700, 376.94800…
$ GPP_NT_CUT_05                  &lt;dbl&gt; NA, NA, 341.388, 1843.090, -4585.100, -…
$ GPP_NT_CUT_16                  &lt;dbl&gt; NA, NA, 360.147, 1847.200, -4549.660, -…
$ GPP_NT_CUT_25                  &lt;dbl&gt; NA, NA, 382.584, 1849.240, 513.146, 513…
$ GPP_NT_CUT_50                  &lt;dbl&gt; NA, NA, 494.939, 1850.860, 641.259, 641…
$ GPP_NT_CUT_75                  &lt;dbl&gt; NA, NA, 525.025, 1857.040, 669.142, 669…
$ GPP_NT_CUT_84                  &lt;dbl&gt; NA, NA, 527.107, 1863.700, 682.551, 682…
$ GPP_NT_CUT_95                  &lt;dbl&gt; NA, NA, 1035.720, 1999.190, 685.614, 68…
$ RECO_DT_CUT_REF                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_USTAR50            &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_MEAN               &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_SE                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_05                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_16                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_25                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_50                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_75                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_84                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_DT_CUT_95                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_REF                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_USTAR50             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_MEAN                &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_SE                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_05                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_16                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_25                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_50                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_75                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_84                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ GPP_DT_CUT_95                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ NETRAD                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ NETRAD_QC                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_1                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_1_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SW_OUT                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SW_OUT_QC                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LW_OUT                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ LW_OUT_QC                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_6                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_6_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_2                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_3                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_4                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_2_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_3_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_4_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_7                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_7_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ PPFD_OUT                       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ PPFD_OUT_QC                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_SR                        &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ RECO_SR_N                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ PPFD_DIF                       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ PPFD_DIF_QC                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_8                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_8_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_9                     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_10                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_9_QC                  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_10_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_5                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_5_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SW_DIF                         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SW_DIF_QC                      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_11                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_11_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_6                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_7                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_8                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_9                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_6_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_7_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_8_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ SWC_F_MDS_9_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_12                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_13                    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_12_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ TS_F_MDS_13_QC                 &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ data_center                    &lt;chr&gt; "AMF", "AMF", "AMF", "AMF", "AMF", "AMF…
$ data_product                   &lt;chr&gt; "FLUXNET", "FLUXNET", "FLUXNET", "FLUXN…
$ dataset                        &lt;chr&gt; "FULLSET", "FULLSET", "FULLSET", "FULLS…
$ time_integral                  &lt;chr&gt; "YY", "YY", "YY", "YY", "YY", "YY", "YY…
$ start_year                     &lt;int&gt; 2012, 2012, 2012, 2012, 2012, 2012, 201…
$ end_year                       &lt;int&gt; 2013, 2013, 2020, 2020, 2020, 2020, 202…
$ site                           &lt;chr&gt; "AR-Bal", "AR-Bal", "AR-CCa", "AR-CCa",…
$ SITE_NAME                      &lt;chr&gt; "Balcarce BA", "Balcarce BA", "Carlos C…
$ COUNTRY                        &lt;chr&gt; "Argentina", "Argentina", "Argentina", …
$ STATE                          &lt;chr&gt; "Buenos Aires", "Buenos Aires", "Buenos…
$ IGBP                           &lt;chr&gt; "CRO", "CRO", "CRO", "CRO", "CRO", "CRO…
$ LOCATION_LAT                   &lt;dbl&gt; -37.7596, -37.7596, -35.6210, -35.6210,…
$ LOCATION_LONG                  &lt;dbl&gt; -58.3024, -58.3024, -61.3181, -61.3181,…
$ LOCATION_ELEV                  &lt;dbl&gt; 130, 130, 83, 83, 83, 83, 83, 83, 83, 8…
$ CLIMATE_KOEPPEN                &lt;chr&gt; "Cfb", "Cfb", "Cfa", "Cfa", "Cfa", "Cfa…
$ MAT                            &lt;dbl&gt; 14.0, 14.0, 16.1, 16.1, 16.1, 16.1, 16.…
$ MAP                            &lt;dbl&gt; 926, 926, 1060, 1060, 1060, 1060, 1060,…
$ DATA_SOURCE                    &lt;chr&gt; "AmeriFlux", "AmeriFlux", "AmeriFlux", …</code></pre>
</div>
</div>
</section>
<section id="igbp-aggregated-flux-summaries" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> IGBP aggregated flux summaries</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p_igbp_nee  <span class="ot">&lt;-</span> <span class="fu">plot_flux_by_igbp</span>(annual_data, <span class="st">"NEE_VUT_REF"</span>)<span class="sc">$</span>composite_plot</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_igbp_nee, <span class="st">"igbp_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/plot-igbp-nee-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p_igbp_gpp  <span class="ot">&lt;-</span> <span class="fu">plot_flux_by_igbp</span>(annual_data, <span class="st">"GPP_NT_VUT_REF"</span>)<span class="sc">$</span>composite_plot</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_igbp_gpp, <span class="st">"igbp_gpp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/plot-igbp-gpp-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p_igbp_reco <span class="ot">&lt;-</span> <span class="fu">plot_flux_by_igbp</span>(annual_data, <span class="st">"RECO_NT_VUT_REF"</span>)<span class="sc">$</span>composite_plot</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_igbp_reco, <span class="st">"igbp_reco"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/plot-igbp-reco-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-sliced-comparison-5-yr-bins" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Time-sliced comparison (5-yr bins)</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>p_timeslice <span class="ot">&lt;-</span> <span class="fu">plot_flux_by_igbp_timeslice_grouped</span>(annual_data, <span class="at">flux_var =</span> <span class="st">"NEE_VUT_REF"</span>)<span class="sc">$</span>flux_plot</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_timeslice, <span class="st">"timeslice_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/timeslice-nee-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interannual-boxplots-by-igbp-groups" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Interannual boxplots by IGBP groups</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>boxplots <span class="ot">&lt;-</span> <span class="fu">plot_flux_box_by_group</span>(annual_data, <span class="at">flux_var =</span> <span class="st">"RECO_NT_VUT_REF"</span>, <span class="at">y_mode =</span> <span class="st">"squish"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(boxplots<span class="sc">$</span>Forest,        <span class="st">"box_forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/grouped-boxplots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(boxplots<span class="sc">$</span>ShrubOpens,    <span class="st">"box_shrubopens"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/grouped-boxplots-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(boxplots<span class="sc">$</span>GrassCropsWet, <span class="st">"box_grasscropswet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/grouped-boxplots-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="median-time-series-by-igbp" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Median time series by IGBP</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_flux_timeseries_by_igbp</span>(annual_data, <span class="st">"NEE_VUT_REF"</span>), <span class="st">"ts_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/ts-nee-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_flux_timeseries_by_igbp</span>(annual_data, <span class="st">"GPP_NT_VUT_REF"</span>), <span class="st">"ts_gpp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/ts-gpp-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_flux_timeseries_by_igbp</span>(annual_data, <span class="st">"RECO_NT_VUT_REF"</span>), <span class="st">"ts_reco"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/ts-reco-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_flux_timeseries_by_igbp</span>(annual_data, <span class="st">"WUE"</span>), <span class="st">"ts_wue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/ts-wue-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="latitudinal-summaries" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Latitudinal summaries</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_latitudinal_flux</span>(annual_data, metadata, <span class="st">"NEE_VUT_REF"</span>),     <span class="st">"lat_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/latitudinal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_latitudinal_flux</span>(annual_data, metadata, <span class="st">"GPP_NT_VUT_REF"</span>),  <span class="st">"lat_gpp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/latitudinal-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">plot_latitudinal_flux</span>(annual_data, metadata, <span class="st">"RECO_NT_VUT_REF"</span>), <span class="st">"lat_reco"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/latitudinal-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="climate-vs-flux-quicklooks" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Climate vs Flux quicklooks</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>cp <span class="ot">&lt;-</span> <span class="fu">plot_annual_fluxnet_data</span>(annual_data)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(cp<span class="sc">$</span>precip_vs_nee, <span class="st">"precip_vs_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/climate-xy-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(cp<span class="sc">$</span>temp_vs_gpp,   <span class="st">"temp_vs_gpp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/climate-xy-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">PlotXY_annual</span>(annual_data, <span class="st">"GPP_NT_VUT_REF"</span>, <span class="st">"LE_F_MDS"</span>), <span class="st">"xy_gpp_le"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/climate-xy-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(<span class="fu">PlotXY_annual</span>(annual_data, <span class="st">"NEE_VUT_REF"</span>,     <span class="st">"LE_F_MDS"</span>), <span class="st">"xy_nee_le"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/climate-xy-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="site-level-climate-flux-summaries-tower" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Site-level climate &amp; flux summaries (tower)</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>climate_summary <span class="ot">&lt;-</span> annual_data <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(site) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_precip =</span> <span class="fu">mean</span>(P_F, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),       <span class="co"># mm/yr (tower)</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_temp   =</span> <span class="fu">mean</span>(TA_F, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),      <span class="co"># °C (tower)</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_GPP    =</span> <span class="fu">mean</span>(GPP_NT_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_NEE    =</span> <span class="fu">mean</span>(NEE_VUT_REF, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_precip_cm =</span> <span class="fu">set_units</span>(mean_precip, <span class="st">"mm"</span>) <span class="sc">|&gt;</span> <span class="fu">set_units</span>(<span class="st">"cm"</span>),  <span class="co"># mm → cm</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">NEE_sign =</span> <span class="fu">ifelse</span>(mean_NEE <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"Sink (NEE &lt; 0)"</span>, <span class="st">"Source (NEE ≥ 0)"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(metadata, <span class="at">by =</span> <span class="st">"site"</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(climate_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 20
  site   mean_precip mean_temp mean_GPP mean_NEE mean_precip_cm NEE_sign SITE_ID
  &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;           [cm] &lt;chr&gt;    &lt;chr&gt;  
1 AR-Bal        433.     13.3     1733.  -161.             43.3 Sink (N… AR-Bal 
2 AR-CCa       3415.     16.8     1160.  -145.            342.  Sink (N… AR-CCa 
3 AR-CCg       2795.     15.3     1387.   -44.1           280.  Sink (N… AR-CCg 
4 AR-SLu        361.     19.7     2578. -1730.             36.1 Sink (N… &lt;NA&gt;   
5 AR-TF1       3430.      6.44     624.     1.86          343.  Source … AR-TF1 
6 AR-TF2       3785.      5.60     289.   -17.1           378.  Sink (N… AR-TF2 
# ℹ 12 more variables: SITE_NAME &lt;chr&gt;, COUNTRY &lt;chr&gt;, STATE &lt;chr&gt;, IGBP &lt;chr&gt;,
#   LOCATION_LAT &lt;dbl&gt;, LOCATION_LONG &lt;dbl&gt;, LOCATION_ELEV &lt;dbl&gt;,
#   CLIMATE_KOEPPEN &lt;chr&gt;, MAT &lt;dbl&gt;, MAP &lt;dbl&gt;, DATA_SOURCE &lt;chr&gt;,
#   SITEID &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="worldclim-extraction-at-tower-locations" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> WorldClim extraction at tower locations</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>wc <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(params<span class="sc">$</span>worldclim_rds))</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Choose lat/lon columns and drop NAs before extraction ---</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>lon_candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LOCATION_LONG"</span>,<span class="st">"LONGITUDE"</span>,<span class="st">"Longitude"</span>,<span class="st">"lon"</span>,<span class="st">"Lon"</span>,<span class="st">"LON"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>lat_candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"LOCATION_LAT"</span>,<span class="st">"LATITUDE"</span>,<span class="st">"Latitude"</span>,<span class="st">"lat"</span>,<span class="st">"Lat"</span>,<span class="st">"LAT"</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>lon_col <span class="ot">&lt;-</span> lon_candidates[lon_candidates <span class="sc">%in%</span> <span class="fu">names</span>(climate_summary)][<span class="dv">1</span>]</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>lat_col <span class="ot">&lt;-</span> lat_candidates[lat_candidates <span class="sc">%in%</span> <span class="fu">names</span>(climate_summary)][<span class="dv">1</span>]</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">is.na</span>(lon_col) <span class="sc">||</span> <span class="fu">is.na</span>(lat_col)) {</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Could not find longitude/latitude columns in climate_summary. "</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Looked for: "</span>, <span class="fu">paste</span>(lon_candidates, <span class="at">collapse=</span><span class="st">", "</span>), <span class="st">" / "</span>,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">paste</span>(lat_candidates, <span class="at">collapse=</span><span class="st">", "</span>))</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>cs_coords <span class="ot">&lt;-</span> climate_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">LON =</span> <span class="sc">!!</span>lon_col, <span class="at">LAT =</span> <span class="sc">!!</span>lat_col) <span class="sc">%&gt;%</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">is.finite</span>(LON), <span class="fu">is.finite</span>(LAT))</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>n_dropped <span class="ot">&lt;-</span> <span class="fu">nrow</span>(climate_summary) <span class="sc">-</span> <span class="fu">nrow</span>(cs_coords)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_dropped <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="fu">message</span>(<span class="st">"WorldClim extraction: dropped "</span>, n_dropped, <span class="st">" site(s) with missing/invalid coordinates."</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Decide extraction engine: use terra if requested OR if object is a SpatRaster</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>use_terra_extraction <span class="ot">&lt;-</span> <span class="fu">isTRUE</span>(params<span class="sc">$</span>use_terra) <span class="sc">||</span> <span class="fu">inherits</span>(wc, <span class="st">"SpatRaster"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (use_terra_extraction) {</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- terra path ---</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"terra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"terra is required for SpatRaster extraction. Install with install.packages('terra') "</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">"or set params$use_terra: false and provide a RasterStack/Brick."</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  site_pts <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">vect</span>(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    cs_coords,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="fu">c</span>(<span class="st">"LON"</span>, <span class="st">"LAT"</span>),</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs  =</span> <span class="st">"EPSG:4326"</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  wc_vals <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">extract</span>(wc, site_pts)</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(wc_vals) <span class="ot">&lt;-</span> <span class="fu">make.names</span>(<span class="fu">names</span>(wc_vals))</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  cs_coords<span class="sc">$</span>MAT_WorldClim <span class="ot">&lt;-</span> wc_vals[[<span class="fu">grep</span>(<span class="st">"bio_1"</span>, <span class="fu">names</span>(wc_vals))[<span class="dv">1</span>]]]</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  cs_coords<span class="sc">$</span>MAP_WorldClim <span class="ot">&lt;-</span> wc_vals[[<span class="fu">grep</span>(<span class="st">"bio_12"</span>, <span class="fu">names</span>(wc_vals))[<span class="dv">1</span>]]]</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- raster fallback ---</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(wc, <span class="st">"SpatRaster"</span>)) {</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    wc_try <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">suppressWarnings</span>(raster<span class="sc">::</span><span class="fu">stack</span>(wc)), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">inherits</span>(wc_try, <span class="st">"try-error"</span>)) {</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>      wc_try <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">suppressWarnings</span>(<span class="fu">as</span>(wc, <span class="st">"Raster"</span>)), <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">inherits</span>(wc_try, <span class="st">"try-error"</span>)) {</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Could not coerce SpatRaster -&gt; Raster for raster::extract. "</span>,</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Set params$use_terra: true to use terra extraction."</span>)</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>    wc <span class="ot">&lt;-</span> wc_try</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>  sp_pts <span class="ot">&lt;-</span> sp<span class="sc">::</span><span class="fu">SpatialPoints</span>(</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> cs_coords[,<span class="fu">c</span>(<span class="st">"LON"</span>,<span class="st">"LAT"</span>)],</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">proj4string =</span> sp<span class="sc">::</span><span class="fu">CRS</span>(<span class="st">"+proj=longlat +datum=WGS84 +no_defs"</span>)</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>  wc_vals <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(wc, sp_pts)</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>  nm <span class="ot">&lt;-</span> <span class="fu">colnames</span>(wc_vals)</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>  mat_col <span class="ot">&lt;-</span> nm[<span class="fu">grepl</span>(<span class="st">"bio_1"</span>, nm)]</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  map_col <span class="ot">&lt;-</span> nm[<span class="fu">grepl</span>(<span class="st">"bio_12"</span>, nm)]</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  cs_coords<span class="sc">$</span>MAT_WorldClim <span class="ot">&lt;-</span> wc_vals[, mat_col][,<span class="dv">1</span>]</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>  cs_coords<span class="sc">$</span>MAP_WorldClim <span class="ot">&lt;-</span> wc_vals[, map_col][,<span class="dv">1</span>]</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge extracted values back into full climate_summary (by site)</span></span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"site"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(cs_coords))) {</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>  cs_coords<span class="sc">$</span>site <span class="ot">&lt;-</span> climate_summary<span class="sc">$</span>site[<span class="fu">match</span>(<span class="fu">rownames</span>(cs_coords), <span class="fu">rownames</span>(climate_summary))]</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>climate_summary <span class="ot">&lt;-</span> climate_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(<span class="st">"MAT_WorldClim"</span>,<span class="st">"MAP_WorldClim"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(cs_coords <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(site, MAT_WorldClim, MAP_WorldClim), <span class="at">by =</span> <span class="st">"site"</span>)</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to Whittaker axes</span></span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>climate_summary <span class="ot">&lt;-</span> climate_summary <span class="sc">%&gt;%</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAT_WorldClim_C  =</span> MAT_WorldClim <span class="sc">/</span> <span class="dv">10</span>,  <span class="co"># °C</span></span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">MAP_WorldClim_cm =</span> MAP_WorldClim <span class="sc">/</span> <span class="dv">10</span>   <span class="co"># mm → cm</span></span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="tower-vs-worldclim-checks" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Tower vs WorldClim checks</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>p_wc_mat <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(climate_summary, <span class="fu">aes</span>(<span class="at">x =</span> MAT_WorldClim_C, <span class="at">y =</span> mean_temp)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"WorldClim MAT (°C)"</span>, <span class="at">y =</span> <span class="st">"Observed Site MAT (°C)"</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_wc_mat, <span class="st">"wc_vs_site_mat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/wc-checks-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>p_wc_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(climate_summary, <span class="fu">aes</span>(<span class="at">x =</span> MAP_WorldClim, <span class="at">y =</span> mean_precip)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"WorldClim MAP (mm)"</span>, <span class="at">y =</span> <span class="st">"Observed Site MAP (mm)"</span>) <span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_wc_map, <span class="st">"wc_vs_site_map"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/wc-checks-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="whittaker-biomes-with-site-overlays" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Whittaker biomes with site overlays</h1>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"Whittaker_biomes"</span>, <span class="at">package =</span> <span class="st">"plotbiomes"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>my_15_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#1b9e77"</span>, <span class="st">"#d95f02"</span>, <span class="st">"#7570b3"</span>, <span class="st">"#e7298a"</span>, <span class="st">"#66a61e"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#e6ab02"</span>, <span class="st">"#a6761d"</span>, <span class="st">"#666666"</span>, <span class="st">"#1f78b4"</span>, <span class="st">"#b2df8a"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fb9a99"</span>, <span class="st">"#fdbf6f"</span>, <span class="st">"#cab2d6"</span>, <span class="st">"#ffff99"</span>, <span class="st">"#8dd3c7"</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>p_whittaker <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Whittaker_biomes,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_c, <span class="at">y =</span> precp_cm, <span class="at">group =</span> biome, <span class="at">fill =</span> biome),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">name =</span> <span class="st">"Biome"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_fill</span>() <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> climate_summary,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> MAT_WorldClim_C, <span class="at">y =</span> MAP_WorldClim_cm, <span class="at">color =</span> IGBP),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">2.8</span>, <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_15_colors, <span class="at">drop =</span> <span class="cn">FALSE</span>, <span class="at">name =</span> <span class="st">"IGBP"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (°C)"</span>, <span class="at">y =</span> <span class="st">"Precipitation (cm yr\u207B\u00B9)"</span>) <span class="sc">+</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_whittaker, <span class="st">"whittaker_igbp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/whittaker-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p_whittaker_nee <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Whittaker_biomes,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_c, <span class="at">y =</span> precp_cm, <span class="at">group =</span> biome, <span class="at">fill =</span> biome),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"BrBG"</span>, <span class="at">name =</span> <span class="st">"Biome"</span>) <span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  ggnewscale<span class="sc">::</span><span class="fu">new_scale_fill</span>() <span class="sc">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> climate_summary,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> MAT_WorldClim_C, <span class="at">y =</span> MAP_WorldClim_cm,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fu">abs</span>(mean_NEE), <span class="at">fill =</span> NEE_sign),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Sink (NEE &lt; 0)"</span> <span class="ot">=</span> <span class="st">"#1b9e77"</span>,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Source (NEE ≥ 0)"</span> <span class="ot">=</span> <span class="st">"#d95f02"</span>),</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"NEE Sign"</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">name =</span> <span class="st">"|NEE|"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Temperature (°C)"</span>, <span class="at">y =</span> <span class="st">"Precipitation (cm yr\u207B\u00B9)"</span>) <span class="sc">+</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="fu">save_if</span>(p_whittaker_nee, <span class="st">"whittaker_nee"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DemoFluxnetFigures_DM_files/figure-html/whittaker-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>